blueprint:
  name: Notify when outside > inside and inside > threshold
  description: >
    Sends a notification when:
    - Outside temperature exceeds the current indoor temperature
    - Indoor temperature exceeds a user-defined threshold
  domain: automation
  input:
    indoor_sensor:
      name: Indoor Temperature Sensor
      selector:
        entity:
          domain: sensor
          device_class: temperature

    outdoor_sensor:
      name: Outdoor Temperature Sensor
      selector:
        entity:
          domain: sensor
          device_class: temperature

    threshold_value:
      name: Temperature Threshold
      description: Only notify if inside temperature is above this
      default: 20.0
      selector:
        number:
          min: 10
          max: 30
          step: 0.1
          mode: box
          unit_of_measurement: "Â°C"

    notify_service:
      name: Notification Service
      description: Enter full notify service ID (e.g. notify.pushover)
      selector:
        text:

    message_title:
      name: Notification Title
      default: "Open a window? Outside cooler than inside"

    message_body:
      name: Notification Body
      default: >
        ðŸŒ¬ï¸ Outdoor temperature ({{ outdoor_temp }}Â°C) is now higher than indoor ({{ indoor_temp }}Â°C),
        and indoor is above your threshold ({{ threshold }}Â°C)

trigger:
  - platform: state
    entity_id: !input outdoor_sensor

  - platform: state
    entity_id: !input indoor_sensor

  - platform: numeric_state
    entity_id: !input indoor_sensor
    above: !input threshold_value

condition:
  - condition: template
    value_template: >
      {% set indoor = states(!input indoor_sensor) | float %}
      {% set outdoor = states(!input outdoor_sensor) | float %}
      {% set threshold = !input threshold_value %}
      {{ outdoor > indoor and indoor > threshold }}

action:
  - variables:
      indoor_temp: "{{ states(!input indoor_sensor) | float }}"
      outdoor_temp: "{{ states(!input outdoor_sensor) | float }}"
      threshold: !input threshold_value
  - service: "{{ !input.notify_service }}"
    data:
      title: !input.message_title
      message: !input.message_body

mode: single
